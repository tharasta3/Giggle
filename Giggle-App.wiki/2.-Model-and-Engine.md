# Story Map

![story-map.png](https://github.com/rgperry/Giggle/blob/main/assets/story-map.png)

# Engine Architecture

![Giggle - Final Engine Diagram - Page 3](https://github.com/user-attachments/assets/3f6cb891-1264-4126-aa9d-132083e16a85)



## Giggle’s Front-End

Inside of the Giggle app, users can browse their saved memes which are organized in folders based on favorited, recently sent, and content/sentiment tags. Tags are created using ChatGPT 4o as described below.
Users can also search for their saved memes in the app. This is accomplished by matching search keywords to memes’ tags.
Users are also able to generate a new meme after inputting a prompt. This is achieved with DALLE-3’s API, as described below.
Users have three different ways to send/share memes that are saved in Giggle. First, inside of a folder, memes can be long-tapped which then displays the option to “Copy” or “Share”. “Copy” saves the meme to the user’s clipboard while the latter opens the iOS share sheet.
Second, after clicking on a meme, a share button is present in the toolbar which opens the iOS share sheet.
The third option is through the Giggle iMessage extension which is detailed down below.

Folder Organization: https://github.com/rgperry/Giggle/blob/main/Giggle/Giggle/FolderView.swift

Search for Memes: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/SharedViews.swift#L118C1-L141C2 (UI)

https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/Datastore.swift#L114C1-L134C2 (search implementation)

Send Memes: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/SharedLogic.swift#L31C1-L47C2

https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/SharedLogic.swift#L49C1-L61C2

## AWS Server

The AWS Server is responsible for collecting memes from a user, sending them to ChatGPT 4o to be tagged, retrieving the tag response, and forwarding the tags back to the front end. When a user enters a prompt to generate a meme, the prompt is sent to the server which then uses the DALL-E 3 API to return a meme based on the prompt’s content.
The server acts as the central location with the API keys to interact with different AI providers. These interactions are covered in depth below.

Memes uploaded to this server aren’t stored after their tags have been sent back to the user. This will help ensure user privacy.

https://github.com/rgperry/Giggle/blob/main/Giggle_backend/routing/urls.py

https://github.com/rgperry/Giggle/blob/main/Giggle_backend/app/utils.py

https://github.com/rgperry/Giggle/blob/main/Giggle_backend/app/views.py

## iMessage Integration

While Giggle’s main interface is contained in its own app, it will also have an integration for iMessage (similar to that of `#images`). This allows users to search and access their memes without opening a separate application outside of their conversation. When opened in iMessage, users can browse all their memes, their favorited memes, recently sent memes, or search either category based on sentiment/content. Users can also enable the meme recommendation toggle, paste in the message they plan to send, and have Giggle recommend a meme to include with the message based on the messages content and sentiment (interacting with ChatGPT 4o as described below).

We initially wanted users to allow Giggle to read the last few messages in their conversation and recommend a meme based off of that information, but we ran into privacy issues since Apple doesn’t allow 3rd parties to access this information.

https://github.com/rgperry/Giggle/blob/main/Giggle/Giggle_IMessage/MessagesViewController.swift

## SwiftData Database

This a local, on-device database that stores memes the user has saved to the Giggle app. For memes in GIF and video format, the URL is kept in memory and used to access/present the memes. For each meme, the tags generated by ChatGPT 4o are also saved (vectorized) for easy lookup and retrieval later. Other metadata including the date the meme was added to Giggle and from where are also stored.
Local storage is an important aspect of Giggle since we wanted the app to be scalable to many users. If we had opted to let users store memes in our database (hosted on AWS), then we would eventually have expenses pile up and no (currently implemented) way to charge users.

Initialization: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/Datastore.swift#L254C13-L254C60

Model Container init: https://github.com/rgperry/Giggle/blob/main/Giggle/Giggle/GiggleApp.swift#L16-L26

Example of use when uploading new memes: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/Datastore.swift#L50C5-L111C2

## iPhone Camera Roll

When the user wants to migrate a meme(s) to Giggle, they can select the migrate button on Giggle’s front-end. This opens iOS' Camera Roll interface for selection of desired memes. Memes in picture, GIF, and video format are accepted, but users should be aware that uploading large videos to Giggle will take longer to load, and could have a negative impact on the speed at which Giggle operates. Once uploaded, memes are then tagged by ChatGPT 4o, stored in the local database, and reflected (organized) on the front-end.
Our implementation of the Camera roll picker uses the PHPicker library due to its easy customization and ability to select more than one item compared to the UIImagePicker library.

https://github.com/rgperry/Giggle/blob/main/Giggle/Giggle/CameraRollView.swift

## 3rd Party Meme Sources [Share Extension]

Often, a user will find a meme they want to save in a 3rd party site (not their camera roll). To streamline the process of adding these memes to Giggle, we have developed the Giggle Share Extension. When an meme on a 3rd party site is long-tapped, the iOS share menu appears, and on it the Giggle app is an option to click. When chosen, a prompt appears asking the user if they would like to save the meme to Giggle, the Giggle favorites folder, or cancel saving.

https://github.com/rgperry/Giggle/blob/main/Giggle/Giggle-Share-RT/ShareViewController.swift

## ChatGPT 4o Mini [Meme Content Analysis]

When a meme is saved to Giggle, it is sent to ChatGPT 4o for content and sentiment analysis. When the meme is a video/GIF, only the first frame is sent. The API will return a list of key features and sentiments present in the meme as tags. These tags will be stored and associated with the meme in the local database entry.
We found using ChatGPT was the most efficient way to get accurate tags for messages due to their easy to use API. We considered using Google Gemini but had prior experience with ChatGPT, and since the tag generation results are similar we used ChatGPT
The prompt we gave ChatGPT along with the meme was “You are tasked with generating {num_tags} descriptive tags for this image. For some context, this image will most likely be a meme. Make sure to take into account the emotion/sentiment of the image, as well as the content of the image. If there is any text or key info also make a descriptive tag for it. If there are any notable people or celebrities in the image make a tag for it. Also don't give any tags that could apply to any meme, like humor or relatable content for example. Don't include any general info in the tag like ___ meme. Just give the ___. Also, only give one word tags unless it is absolutely necessary to do two or more. The cases it would be necessary would be if you had a celebrity or character with a two word name, or if there is an event or something else that the meme is referencing that has more than one word. For example, the chef Martha Stewart, or the event Black Friday. The general sentiment/emotion tags should be one word. For example relatable content should just be relatable. Return the tags in a comma separated list. I repeat your response to this message should ONLY be a list of the tags that you have generated, separated by commas. No brackets necessary.”

Link to API call: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle_backend/app/utils.py#L113C1-L159C33

Link to front end: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/Datastore.swift#L271C5-L293C6

## DALL-E 3 [Meme Generation]

In the Giggle front-end, users can select the "Create Meme" button, which prompts them to enter a short description of the meme they want to create. This description is then sent to the DALLE-3 API which returns the meme. Users then have the option to save the meme, discard it, or generate another one (with a potentially updated query). If saved, the meme undergoes the same process as a new meme being uploaded to Giggle. DALL-E 3 was our initial choice for meme creation since it has a relatively low cost. Google also hadn’t integrated the Imagen 3 text-to-image into an API yet, but could potentially be a better choice to rework Giggle in the future.

Link to API call: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle_backend/app/utils.py#L11C1-L42C20

Link to front end: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle/GenerateMemeView.swift#L46C17-L53C18

## ChatGPT 4o Mini [Text Sentiment Analysis]

In the iMessage extension, when Giggle’s recommendation extension is enabled, messages will be collected then sent to ChatGPT 4o Mini for analysis of content and sentiment. This analysis (list of keywords/tags) is then sent back to Giggle’s handlers to search the user’s meme database for relevant memes. If any memes are within threshold relevancy (TBD), the user is prompted to send them in their conversation.
We found using ChatGPT was the most efficient way to get accurate tags for messages due to their easy to use API. We considered using Google Gemini but had prior experience with ChatGPT, and since the tag generation results are similar we used ChatGPT.
The prompt we gave ChatGPT along with the message was “You are tasked with generating 10 descriptive tags for the following message. You can generate more if you think it is necessary. The message that we will give you will be sent in a conversation. For context, we have a predefined list of tags for memes stored in a database. The tags that you generate must only be selected from this list, which we will provide. The tags will be used to find a meme that matches the sentiment/emotion of the text message. For example, if the message is 'I'm really excited to see you' and the database contains tags like smile, happy, excited, and good, you would return those tags. If no relevant tags are found in the provided list, return an empty string. Here is the message: {message}. Here is the list of tags from our database: {tags}. Return the tags in a single string, with each tag separated by spaces. Make sure they are all lowercase. Thank you.”

Link to API call: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle_backend/app/utils.py#L74C1-L110C46

Link to front end: https://github.com/rgperry/Giggle/blob/e65516745a204f650d31be8362c3ad91a2ad72b4/Giggle/Giggle_IMessage/MessagesViewController.swift#L206C5-L271C6